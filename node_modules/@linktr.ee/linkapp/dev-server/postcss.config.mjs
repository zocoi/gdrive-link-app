import { fileURLToPath } from 'url'
import { dirname, resolve } from 'path'
import tailwindcss from '@tailwindcss/postcss'
import { createTailwindSourceFallback } from './postcss/tailwind-source-fallback.js'

const __filename = fileURLToPath(import.meta.url)
const __dirname = dirname(__filename)

const userProjectRoot = process.env.LINKAPP_USER_PROJECT_PATH
const projectRoot = userProjectRoot ? resolve(userProjectRoot) : null

const plugins = []

if (projectRoot) {
  plugins.push(
    createTailwindSourceFallback({
      projectRoot,
    })
  )
}

plugins.push(
  tailwindcss({
    base: __dirname,
  })
)

export default {
  plugins,
}
