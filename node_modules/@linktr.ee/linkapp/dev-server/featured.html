<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Featured - LinkApp</title>

    <!-- iframe-resizer: Required for iframe height auto-adjustment -->
    <script crossorigin src="https://unpkg.com/iframe-resizer@4.3.2/js/iframeResizer.contentWindow.js"></script>

    <!-- Linktree theme variables will be injected here -->
    <style id="linktree-theme"></style>

    <script>
      /**
       * Helper function to convert CSS variables object to CSS string
       * @param {Record<string, string>} vars - Object with CSS variable names as keys
       * @returns {string} CSS string like "--var1: value1; --var2: value2;"
       */
      function renderCssVariables(vars) {
        return Object.entries(vars)
          .map((entry) => entry.join(': '))
          .join('; ') + ';'
      }

      /**
       * Apply theme CSS variables to :root
       * Called once on mount from main.tsx
       * @param {Record<string, string>} variables - CSS variables to apply
       */
      function applyTheme(variables) {
        if (!variables || typeof variables !== 'object') {
          return
        }

        // Get the style element where theme variables are injected
        const themeStyle = document.getElementById('linktree-theme')

        if (!themeStyle) {
          console.warn('linktree-theme style element not found')
          return
        }

        // Inject CSS variables into :root
        themeStyle.textContent = ':root { ' + renderCssVariables(variables) + ' }'
      }

      // Export applyTheme to be used by main.tsx
      window.__linkapp_applyTheme = applyTheme

      /**
       * Apply font to iframe by injecting font CSS or external stylesheet
       * Called once on mount from main.tsx
       * @param {Object} fontData - Font configuration from parent
       * @param {string} fontData.fontFamily - Font family name (e.g., "Inter", "Karla")
       * @param {string} [fontData.cssUrl] - External CSS URL to load (e.g., Google Fonts, TypeKit)
       * @param {string} [fontData.fontStyle] - Inline @font-face CSS definitions
       */
      function applyFont(fontData) {
        if (!fontData || typeof fontData !== 'object') {
          console.warn('[applyFont] Invalid fontData')
          return
        }

        // Remove existing font style/link if present to avoid duplicates
        const existingFontElement = document.getElementById('linktree-font')
        if (existingFontElement) {
          existingFontElement.remove()
        }

        // Option 1: External CSS URL (e.g., Google Fonts, TypeKit, custom CDN)
        if (fontData.cssUrl) {
          const link = document.createElement('link')
          link.id = 'linktree-font'
          link.rel = 'stylesheet'
          link.href = fontData.cssUrl
          link.crossOrigin = 'anonymous'
          link.onerror = () => console.error('[applyFont] CSS failed to load')
          document.head.appendChild(link)
        }
        // Option 2: Inline @font-face definitions
        else if (fontData.fontStyle) {
          const style = document.createElement('style')
          style.id = 'linktree-font'
          style.textContent = fontData.fontStyle
          document.head.appendChild(style)
        }

        // Apply font-family to body element so all content inherits it
        if (fontData.fontFamily) {
          document.body.style.fontFamily = fontData.fontFamily
        }
      }

      // Export applyFont to be used by main.tsx
      window.__linkapp_applyFont = applyFont
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/featured/main.tsx"></script>
  </body>
</html>
