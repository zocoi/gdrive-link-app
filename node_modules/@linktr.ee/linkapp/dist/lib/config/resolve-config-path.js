import { existsSync } from 'node:fs';
import { join } from 'node:path';
/**
 * Resolves the path to linkapp.config.ts in a project.
 * Checks both root directory and .config directory for backward compatibility.
 *
 * @param projectPath - The root directory of the LinkApp project
 * @returns The absolute path to linkapp.config.ts
 * @throws Error if config file is not found
 */
export function resolveConfigPath(projectPath) {
    const rootConfigPath = join(projectPath, 'linkapp.config.ts');
    const nestedConfigPath = join(projectPath, '.config', 'linkapp.config.ts');
    if (existsSync(rootConfigPath)) {
        return rootConfigPath;
    }
    if (existsSync(nestedConfigPath)) {
        return nestedConfigPath;
    }
    throw new Error('Configuration file not found. Expected linkapp.config.ts in project root or .config directory.');
}
/**
 * Extracts the LinkApp ID from a configuration file.
 * The ID is derived from manifest.name using kebab-case conversion.
 *
 * @param configPath - Absolute path to linkapp.config.ts
 * @returns The LinkApp ID (kebab-cased manifest name)
 * @throws Error if config cannot be loaded or manifest.name is missing
 */
export async function getLinkAppIdFromConfig(configPath) {
    const { createJiti } = await import('jiti');
    const jiti = createJiti(import.meta.url, {
        interopDefault: true,
        moduleCache: false,
    });
    try {
        const config = jiti(configPath);
        if (!config?.manifest?.name) {
            throw new Error('manifest.name is required in linkapp.config.ts');
        }
        // Derive ID from name using kebab-case (matches backend behavior)
        return config.manifest.name
            .toLowerCase()
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/^-+|-+$/g, ''); // Remove leading/trailing hyphens
    }
    catch (error) {
        if (error instanceof Error && error.message.includes('manifest.name is required')) {
            throw error;
        }
        throw new Error(`Failed to load linkapp.config.ts: ${error instanceof Error ? error.message : String(error)}`);
    }
}
//# sourceMappingURL=resolve-config-path.js.map