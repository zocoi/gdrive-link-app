import * as p from '@clack/prompts';
import { generateManifestFiles } from './generate-manifest-files.js';
import { packProject } from './pack-project.js';
import { checkLinkAppExists } from './upload.js';
import { pluralize } from '../utils/formatters.js';
/**
 * Prepares all deployment artifacts including manifests and packed files.
 * Also checks if the LinkApp already exists on the platform.
 *
 * @param context - Deployment context
 * @returns Artifact preparation result
 */
export async function prepareDeploymentArtifacts(context) {
    const s = p.spinner();
    // Generate manifest files from config
    s.start('Generating manifest files');
    await generateManifestFiles(context.projectPath);
    s.stop('Manifest files generated');
    // Check if LinkApp exists
    s.start('Checking LinkApp status');
    const apiUrl = context.options.endpoint ?? `${context.config.link_types_url}/link-types`;
    const exists = await checkLinkAppExists(apiUrl, context.linkAppId, context.accessToken);
    const action = exists ? 'Updating existing LinkApp' : 'Creating new LinkApp';
    s.stop(action);
    // Pack project files
    s.start('Packing project files');
    const packedFiles = await packProject({ projectPath: context.projectPath });
    s.stop(`Packed ${pluralize(packedFiles.length, 'item')}`);
    return {
        packedFiles,
        exists,
        apiUrl,
    };
}
//# sourceMappingURL=artifacts.js.map