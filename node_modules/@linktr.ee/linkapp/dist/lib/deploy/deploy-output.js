import pc from 'picocolors';
import { writeLine, writeSeparator, formatElapsedTime, formatTimestamp, isAPIError, DeploymentCancelledError, AuthenticationError, URLS, } from './deploy-utils.js';
/**
 * Displays successful deployment results.
 */
export function displayDeploymentSuccess(context, result) {
    const totalTime = formatElapsedTime(Date.now() - context.startTime);
    writeLine();
    writeSeparator();
    writeLine(pc.green(pc.bold('\n✓ Deployment successful!')));
    writeLine(pc.dim(`  Completed in ${totalTime}`));
    writeLine();
    writeLine(pc.bold('Details:'));
    writeLine(pc.dim(`  ID:      ${result.linkType.linkTypeId}`));
    writeLine(pc.dim(`  Status:  ${result.linkType.status}`));
    const timestamp = formatTimestamp(result.linkType.updatedTimestamp);
    if (timestamp) {
        writeLine(pc.dim(`  Updated: ${timestamp}`));
    }
    writeLine();
    writeLine(pc.bold('Next steps:'));
    if (result.build?.id) {
        const buildUrl = URLS.buildStatus(result.linkType.linkTypeId, result.build.id);
        writeLine(pc.cyan('  1. Building your LinkApp (this may take a few minutes):'));
        writeLine(pc.dim(`     ${buildUrl}`));
        writeLine();
    }
    const createUrl = context.env === 'qa'
        ? URLS.adminCreateLink.qa(result.linkType.linkTypeId)
        : URLS.adminCreateLink.production(result.linkType.linkTypeId);
    writeLine(pc.cyan('  2. Once the build completes, add it to your page:'));
    writeLine(pc.dim(`     ${createUrl}`));
    writeLine();
}
/**
 * Displays deployment error information.
 */
export function displayDeploymentError(error) {
    writeLine();
    writeSeparator();
    writeLine(pc.red(pc.bold('\n✗ Deployment failed')));
    writeLine();
    if (error instanceof DeploymentCancelledError) {
        writeLine(pc.yellow('⚠ Deployment cancelled'));
        writeLine();
        return;
    }
    if (error instanceof AuthenticationError) {
        writeLine(pc.dim(`  ${error.userMessage ?? error.message}`));
        writeLine();
        return;
    }
    if (isAPIError(error)) {
        writeLine(pc.bold('Error Details:'));
        writeLine(pc.red(`  Status: ${error.statusCode}`));
        if (error.messages.length > 0) {
            writeLine();
            writeLine(pc.bold('  Validation Errors:'));
            for (const msg of error.messages) {
                writeLine(pc.red(`    • ${msg}`));
            }
        }
        if (error.responseData?.error) {
            writeLine();
            writeLine(pc.bold('  Error Type:'));
            writeLine(pc.red(`    ${error.responseData.error}`));
        }
        writeLine();
        return;
    }
    if (error instanceof Error) {
        writeLine(pc.dim(`  ${error.message}`));
    }
    else {
        writeLine(pc.dim(`  ${String(error)}`));
    }
    writeLine();
}
//# sourceMappingURL=deploy-output.js.map